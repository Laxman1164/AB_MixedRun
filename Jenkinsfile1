pipeline {
    agent any
    stages {
        stage('Run JMeter Tests') {
            steps {
                script {
                    sh '''
                    docker run --rm \
                      -v $WORKSPACE:/test \
                      dockerjmeter \
                      jmeter -n -t /test/webtours1610.jmx -l /test/results.jtl
                    '''
                }
            }
        }
        stage('Archive Results') {
            steps {
                archiveArtifacts artifacts: 'results.jtl', fingerprint: true
            }
        }
    }
}
